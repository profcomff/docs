# Форма запроса доступа

Ее можно найти по адресам:
- <https://app.profcomff.com/apps/46>
- <https://forms.yandex.ru/u/65663f2784227c1f53dd8a15/>


## Пришел запрос на получение доступа, что делать?

После заполнения формы лидам приходят сообщения вида

> Запрос доступа к платформе
>
> id пользователя: 123
> Логин: SomeLI
> Почта my.msu.ru:
> Github: someli
> Email: login@example.com
> Системы: Github, EasyCode
>
> Что делать? https://docs.profcomff.com/access/form-platform.html

В зависимости от графы "Системы" могут потребоваться различные доступы

Базово, командам нужны следующие системы:
- Бэкэнд: Github, EasyCode, БД
- Фронтенд: Github, EasyCode
- Работа с данными: Github, EasyCode, БД, Airflow, Datalens

Выдача доступов производится в 3 этапа:
1. Создавние аккаунта в внешней системе
2. Привязка аккаунта к Твой ФФ
3. Сообщение пользователю, что ему выдан доступ и нужно поменять пароль от твой фф, чтобы
    установился пароль во всех системах


### EasyCode

1. Создать пользователя
   1. Перейти на страницу <https://easycode.profcomff.com/users/create> (в верхнем меню Users, далее Create User)
   2. Ввести username в нижнем регистре из поля "Логин" формы
   3. Ввести email из поля "Email" формы
   4. Выбрать тип входа "Пароль"
   5. Ввести в поле "Password" случайный набор символов

2. Привязать аккаунт к твой ФФ
   1. Переходим к [Auth API](https://api.profcomff.com/?urls.primaryName=auth#/coder_outer_auth/_link_coder__user_id__link_post)
   2. Жмем "Try it out" в `/coder/{user_id}/link`
   3. Указываем "id пользователя" и "Логин" из формы в поля "user_id" и "username" соответственно
   4. Жмем синюю кнопку Execute

3. Сообщить пользователю о готовности

    ```
    Тебе выдан доступ к сервису EasyCode.
    https://easycode.profcomff.com/

    Доступ к EasyCode возможен по паролю от Твой ФФ и указанной тобой электронной почте.
    Чтобы доступ появился нужно поменять пароль от Твой ФФ. Чтобы поменять пароль:
    - Перейди в приложение Твой ФФ https://app.profcomff.com
    - В нижнем меню выбери "Профиль"
    - Если ты вышел из приложения, введи свои логин и пароль для входа, нажми кнопку "Войти"
    - В правом верхнем углу открой "Настройки"
    - Выбери "Изменить пароль"
    - Введи текущий и новый пароли, нажми "Изменить"
    ```

### БД

1. Создать пользователя
   1. Войти в любой SQL клиент, например в <https://db.profcomff.com>.
   2. Выполнить команду для создания пользователя

        ```sql
        -- Создать пользователя
        -- Надо заменить SurnameNM на логин из формы в нижнем регистре
        -- Пароль сгенерировать случайным образом
        CREATE USER SurnameNM WITH LOGIN PASSWORD 'SomeRandomShit!';
        ```

   3. Добавить пользователя в группы командой

        ```sql
        -- Заменить group_name на название группы, SurnameNM на логин из формы в нижнем регистре
        GRANT group_name TO SurnameNM;
        ```

        Доступные группы:
        - `group_superadmin` – суперадминистраторы БД, с правами на вообще все действия
        - `group_admins` – администраторы БД с правами на создание, удаление и изменение таблиц, изменение пользователей
        - `group_devuser` – пользователи с доступом к базе данных dev
        - `group_dwh_developer` – пользователи с полным доступом к dwh-test и доступом на чтение к dwh
        - `group_dwh_user` – пользователи с правами на чтение в dwh на некоторые конечные данные

2. Привязать аккаунт к твой ФФ
   1. Переходим к [Auth API](https://api.profcomff.com/?urls.primaryName=auth#/postgres_outer_auth/_link_postgres__user_id__link_post)
   2. Жмем "Try it out" в `/postgres/{user_id}/link`
   3. Указываем "id пользователя" и "Логин" из формы в поля "user_id" и "username" соответственно
   4. Жмем синюю кнопку Execute

3. Сообщить пользователю о готовности

    ```
    Тебе выдан доступ к сервису БД.
    https://db.profcomff.com

    Доступ к БД возможен по паролю от Твой ФФ и указанному тобой логину.
    Чтобы доступ появился нужно поменять пароль от Твой ФФ. Чтобы поменять пароль:
    - Перейди в приложение Твой ФФ https://app.profcomff.com
    - В нижнем меню выбери "Профиль"
    - Если ты вышел из приложения, введи свои логин и пароль для входа, нажми кнопку "Войти"
    - В правом верхнем углу открой "Настройки"
    - Выбери "Изменить пароль"
    - Введи текущий и новый пароли, нажми "Изменить"

    Для входа тебе также понадобятся реквизиты БД:
    Host: `db.profcomff.com`
    Port: `25432`
    Database: `dwh`
    SSL Mode: disable
    Username: <логин в формате ФамилияИО транслитом>
    Password: <пароль от Твой ФФ>
    ```

### Airflow

1. Создать пользователя
   1. Войти в airflow по адресу <https://airflow.profcomff.com>
   2. В верхнем меню перейти на Security -> List users
   3. Нажать синюю кнопку "+" (Add a new record)
   4. Заполнить поля.
      - Поле "User Name" заполнить полем "Логин" из формы в нижнем регистре
      - В поле Role установить User
      - Пароль заполнить случайным сложным значением

2. Привязать аккаунт к твой ФФ
   1. Переходим к [Auth API](https://api.profcomff.com/?urls.primaryName=auth#/airflow_outer_auth/_link_airflow__user_id__link_post)
   2. Жмем "Try it out" в `/airflow/{user_id}/link`
   3. Указываем "id пользователя" и "Логин" из формы в поля "user_id" и "username" соответственно
   4. Жмем синюю кнопку Execute

3. Сообщить пользователю о готовности

    ```
    Тебе выдан доступ к сервису Airflow.
    https://airflow.profcomff.com

    Доступ к БД возможен по паролю от Твой ФФ и указанному тобой логину.
    Чтобы доступ появился нужно поменять пароль от Твой ФФ. Чтобы поменять пароль:
    - Перейди в приложение Твой ФФ https://app.profcomff.com
    - В нижнем меню выбери "Профиль"
    - Если ты вышел из приложения, введи свои логин и пароль для входа, нажми кнопку "Войти"
    - В правом верхнем углу открой "Настройки"
    - Выбери "Изменить пароль"
    - Введи текущий и новый пароли, нажми "Изменить"
    ```

### DataLens

1. Выдать доступ
   1. Перейти к папке PROFCOMFF
   2. Нажать на 3 точки рядом с названием папки, выбрать "Права доступа", далее "Права на папку и содержимое"
   3. Выбрать Исполнение, Просмотр, Редактирование или Администрирование
   4. В "Добавить участника" ввести Email `@my.msu.ru`

2. Сообщить пользователю о готовности

    ```
    Тебе выдан доступ к сервису DataLens.
    https://datalens.yandex.cloud/

    Доступ к DataLens возможен по паролю к профилю `@my.msu.ru`. После входа в левом меню можно
    будет найти папку PROFCOMFF c рабочими объектами.
    ```

### GitHub

1. Пригласить пользователя в организацию

2. Сообщить пользователю о готовности

    ```
    Тебе выдан доступ к сервису GitHub.
    https://github.com/profcomff

    Доступ к GitHub возможен по паролю к профилю GitHub
    ```
