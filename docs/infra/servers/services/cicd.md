# CI/CD

## Как это работает?
В каждом репозитории лежит папка `.github/workflows`, в которой лежат файлы формата `.yaml`. Эти файлы представляют собой воркфлоу CI/CD контура  - своего рода задачи или их объединение.

В таком файле прописаны задачи, шаги и условия запуска задач - например, на каждый коммит в `main`.

Когда приходит пора запускать задачу, GitHub Actions смотрят, на какой машине надо их запускать. Тесты и статический анализ кода, да и сборку мы стараемся запускать на машинах GitHub, чтобы не нагружать наши. Однако запуск контейнеров мы производим, очевидно, на своих.

Если надо запустить задачу на нашей машине, гитхаб отправляет к ней запрос, на ней предварительно должен быть установлен GitHub Runner, подключение между ними происходит по https.

Runner забирает задачу и выполняет ее. Если задач много, он может тормозить.

## Как добавить сервера в организацию

1. Зайти [сюда](https://github.com/organizations/profcomff/settings/actions/runners) и нажать на кнопку `New runner`
2. Выпадет инструкция, как установить runner на сервер и сконфигурировать его
3. Используя теги, можно управлять выбором раннера для конкретного job в CI/CD

## Схема развертывания сейчас

Резвернут 1 инстанс в продовой среде и 1 в тестовой среде

Лежит в папке `srvc__github_runner`, разворачивается _не_ в докере.

## Ссылки

[Что такое CI/CD](https://habr.com/ru/companies/otus/articles/515078/)

[Про GitHub Actions](https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions)
