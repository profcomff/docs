# CI/CD

## Что это такое?
Непрерывная интеграция (Continuous Integration, CI) и непрерывная поставка (Continuous Delivery, CD) представляют собой культуру, набор принципов и практик, которые позволяют разработчикам чаще и надежнее развертывать изменения программного обеспечения.

Непрерывная интеграция — это методология разработки и набор практик, при которых в код вносятся небольшие изменения с частыми коммитами. И поскольку большинство современных приложений разрабатываются с использованием различных платформ и инструментов, то появляется необходимость в механизме интеграции и тестировании вносимых изменений.

С технической точки зрения, цель CI — обеспечить последовательный и автоматизированный способ сборки, упаковки и тестирования приложений. При налаженном процессе непрерывной интеграции разработчики с большей вероятностью будут делать частые коммиты, что, в свою очередь, будет способствовать улучшению коммуникации и повышению качества программного обеспечения.

Непрерывная интеграция и непрерывная поставка нуждаются в непрерывном тестировании, поскольку конечная цель — разработка качественных приложений. Непрерывное тестирование часто реализуется в виде набора различных автоматизированных тестов (регрессионных, производительности и других), которые выполняются в CI/CD-конвейере.

## Как это работает?
В каждом репозитории лежит папка `.github/workflows`, в которой лежат файлы формата `.yaml`. Эти файлы представляют собой воркфлоу CI/CD контура  - своего рода задачи или их объединение.

В таком файле прописаны задачи, шаги и условия запуска задач - например, на каждый коммит в `main`.

Когда приходит пора запускать задачу, GitHub Actions смотрят, на какой машине надо их запускать. Тесты и статический анализ кода, да и сборку мы стараемся запускать на машинах GitHub, чтобы не нагружать наши. Однако запуск контейнеров мы производим, очевидно, на своих.

Если надо запустить задачу на нашей машине, гитхаб отправляет к ней запрос, на ней предварительно должен быть установлен GitHub Runner, подключение между ними происходит по https.

Runner забирает задачу и выполняет ее. Если задач много, он может тормозить.

## Как добавить сервера в организацию

1. Зайти [сюда](https://github.com/organizations/profcomff/settings/actions/runners) и нажать на кнопку `New runner`
2. Выпадет инструкция, как установить runner на сервер и сконфигурировать его
3. Используя теги, можно управлять выбором раннера для конкретного job в CI/CD

## Схема развертывания сейчас

Резвернут 1 инстанс в продовой среде и 1 в тестовой среде

Лежит в папке `srvc__github_runner`, разворачивается _не_ в докере.

## Ссылки

[Что такое CI/CD](https://habr.com/ru/companies/otus/articles/515078/)

[Про GitHub Actions](https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions)
